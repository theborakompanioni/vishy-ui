!function(e){e.module("angular-vissense.config",[]).value("angularVissenseConfig",{debug:!0}),e.module("angular-vissense.services",[]),e.module("angular-vissense.directives",["angular-vissense.services"]),e.module("angular-vissense.directives.debug",[]),e.module("angular-vissense",["angular-vissense.config","angular-vissense.directives","angular-vissense.services"])}(angular),function(e){e.module("angular-vissense.directives").directive("vissenseMonitor",["VisSense","VisUtils",function(e,i){var t={scope:{monitor:"=?ngModel",config:"@",onStart:"&",onStop:"&",onUpdate:"&",onHidden:"&",onVisible:"&",onFullyvisible:"&",onPercentagechange:"&",onVisibilitychange:"&"},link:function(t,n){var s=i.throttle(function(){t.$digest(),t.$parent.$digest()},1e3);n.addClass("vissense-monitor"),t.monitor=new e(n[0],t.config).monitor({start:function(e){t.onStart({monitor:e})},stop:function(e){t.onStop({monitor:e})},update:function(e){t.onUpdate({monitor:e}),s()},hidden:function(e){t.onHidden({monitor:e})},visible:function(e){t.onVisible({monitor:e})},fullyvisible:function(e){t.onFullyvisible({monitor:e})},percentagechange:function(e,i,n){t.onPercentagechange({monitor:e,newValue:i,oldValue:n})},visibilitychange:function(e){t.onVisibilitychange({monitor:e}),n.removeClass("vissense-monitor-hidden"),n.removeClass("vissense-monitor-fullyvisible"),n.removeClass("vissense-monitor-visible"),e.state().fullyvisible?n.addClass("vissense-monitor-fullyvisible"):e.state().hidden?n.addClass("vissense-monitor-hidden"):n.addClass("vissense-monitor-visible")}}).startAsync(),t.$on("$destroy",function(){t.monitor.stop()})}};return t}])}(angular),function(e){e.module("angular-vissense.directives.debug").directive("vissenseMetricsInfocard",["VisSense","VisUtils",function(e,i){if(!i.isFunction(e.VisMon.Strategy.MetricsStrategy))throw new Error("Cannot load MetricsStrategy. Is it included?");if(!i.isFunction(e.VisMon.Strategy.MetricsStrategy))throw new Error("Cannot load MetricsStrategy. Is it included?");var t={scope:{elementId:"@vissenseMetricsInfocard",inactiveAfter:"@",hidden:"@"},controller:["$scope","$interval","VisSenseService",function(t,n,s){t.model={inactiveAfter:(parseInt(t.inactiveAfter,10)||3e4)-1};var a=s.fromId(t.elementId,{hidden:t.hidden}),r=[new e.VisMon.Strategy.PollingStrategy({interval:99}),new e.VisMon.Strategy.EventStrategy({debounce:30}),new e.VisMon.Strategy.MetricsStrategy];if(i.isFunction(e.VisMon.Strategy.UserActivityStrategy)){var o=new e.VisMon.Strategy.UserActivityStrategy({inactiveAfter:t.model.inactiveAfter});r.push(o)}var l=a.monitor({strategy:r,visibilitychange:i.debounce(function(e){t.$apply(function(){var i=e.state();t.code=i.code,t.state=i.state})},0)}).start(),c=i.debounce(function(){var e=l.metrics();t.$apply(function(){t.timeHidden=e.getMetric("time.hidden").get(),t.timeVisible=e.getMetric("time.visible").get(),t.timeFullyVisible=e.getMetric("time.fullyvisible").get(),t.timeRelativeVisible=e.getMetric("time.relativeVisible").get(),t.duration=e.getMetric("time.duration").get(),t.percentage={current:e.getMetric("percentage").get(),max:e.getMetric("percentage.max").get(),min:e.getMetric("percentage.min").get()}})},0),d=n(c,100);t.$on("$destroy",function(){l.stop(),n.cancel(d)})}],template:'<style>.vissense-metrics-container {margin: 0px;position: fixed;left: 42px;bottom: 13px;width: 600px;height: 200px;box-shadow: 1px 1px 1px 2px rgba(99, 99, 99, 0.4);z-index: 99999;background-color: rgba(242,242,242,0.9);}.vissense-flexbox {display: box;display: -webkit-box;display: -moz-box;box-orient: horizontal;-webkit-box-orient: horizontal;-moz-box-orient: horizontal;}.vissense-flexbox .box {font-size: 23px;padding: 10px;width: 150px;text-align: center;}.vissense-flexbox .vissense-box small {color: #888;}</style><div class="vissense-metrics-container"><div style="text-align:center"><span>state: <span data-ng-style="{ color : code > 0 ? \'green\' : \'red\'}">{{state}}</span></span> | <span data-vissense-user-activity data-inactive-after="{{model.inactiveAfter}}"></span></div><div class="vissense-flexbox"><div class="box"><div>{{timeVisible / 1000 | number:1}}s</div><small>time visible</small></div><div class="box"><div>{{timeFullyVisible / 1000 | number:1}}s</div><small>time fullyvisible</small></div><div class="box"><div>{{timeHidden * 100 / duration | number:0}}%</div><small>percentage hidden</small></div><div class="box"><div>{{timeVisible * 100 / duration | number:0}}%</div><small>percentage visible</small></div></div><div class="vissense-flexbox"><div class="box"><div>{{timeHidden / 1000 | number:1}}s</div><small>time hidden</small></div><div class="box"><div>{{timeRelativeVisible / 1000 | number:1}}s</div><small>time relative</small></div><div class="box"><div>{{percentage.min * 100 | number:0}}%</div><small>percentage min</small></div><div class="box"><div>{{percentage.max * 100 | number:0}}%</div><small>percentage max</small></div></div></div>'};return t}])}(angular),function(e){e.module("angular-vissense.directives.debug").directive("vissensePercentageTimeTest",["VisSenseService",function(e){var i={scope:{elementId:"@vissensePercentageTimeTest",timeLimit:"@",percentageLimit:"@",interval:"@"},controller:["$scope",function(i){var t=e.fromId(i.elementId);i.passed=!1,t.onPercentageTimeTestPassed(function(){i.$apply(function(){i.passed=!0})},{percentageLimit:i.percentageLimit||.5,timeLimit:i.timeLimit||1e3,interval:i.interval||100})}],template:"<span>{{percentageLimit * 100 | number:0}}/{{timeLimit / 1000 | number:0}} test: <span data-ng-style=\"{ color : passed ? 'green' : 'red'}\">{{passed}}</span></span>"};return i}]).directive("vissenseFiftyOneTest",[function(){var e={scope:{elementId:"@vissenseFiftyOneTest"},template:'<span data-vissense-percentage-time-test="{{elementId}}" data-percentage-limit="0.5" data-time-limit="1000" data-interval="100"></span>'};return e}]).directive("vissenseSixtyOneTest",[function(){var e={scope:{elementId:"@vissenseSixtyOneTest"},template:'<span data-vissense-percentage-time-test="{{elementId}}" data-percentage-limit="0.6" data-time-limit="1000" data-interval="100"></span>'};return e}])}(angular),function(e){e.module("angular-vissense.directives.debug").directive("vissensePercentage",["VisSenseService","VisUtils","$timeout",function(e,i,t){var n={scope:{elementId:"@vissensePercentage"},controller:["$scope",function(n){n.percentage="?",t(function(){var t=e.fromId(n.elementId).monitor({percentagechange:i.debounce(function(){n.$apply(function(){n.percentage=t.state().percentage})},10)}).start();n.$on("$destroy",function(){t.stop()})})}],template:"<span>{{percentage * 100 | number:0}}%</span>"};return n}])}(angular),function(e){e.module("angular-vissense.directives.debug").directive("vissenseState",["VisSenseService","VisUtils","$timeout",function(e,i,t){var n={scope:{elementId:"@vissenseState",fullyvisible:"@",hidden:"@",strategy:"@"},link:function(n){n.state="?",t(function(){var t=e.fromId(n.elementId,{fullyvisible:parseFloat(n.fullyvisible)||1,hidden:parseFloat(n.hidden)||0}).monitor({visibilitychange:i.debounce(function(e){n.$apply(function(){n.state=e.state().state})},10)}).start();n.$on("$destroy",function(){t.stop()})})},template:"<span>{{state}}</span>"};return n}]).directive("vissenseStateDebug",["VisSenseService","VisUtils","$timeout",function(e,i,t){var n={scope:{elementId:"@vissenseStateDebug"},controller:["$scope",function(n){n.state={},t(function(){var t=e.fromId(n.elementId).monitor({update:i.debounce(function(e){n.$apply(function(){n.state=e.state()})},10)}).start();n.$on("$destroy",function(){t.stop()})})}],template:"{{ state | json }}"};return n}])}(angular),function(e){e.module("angular-vissense.directives.debug").directive("vissenseUserActivity",["VisSense","VisUtils",function(e,i){var t={scope:{inactiveAfter:"@",debounce:"@"},controller:["$scope",function(t){if(t.active=!0,t.installed=i.isFunction(e.UserActivity),t.installed){t.options={inactiveAfter:parseInt(t.inactiveAfter,10)||3e4,debounce:parseInt(t.debounce,10)||50,update:i.debounce(function(e){t.active=e.isActive(),t.$digest()},10)};var n=new e.UserActivity(t.options).start();t.$on("$destroy",function(){n.stop()})}}],template:"<span>user active: <span data-ng-style=\"{ color : active ? 'green' : 'red'}\">{{active}}</span><span data-ng-if=\"!installed\"> (not installed)</span></span>"};return t}])}(angular),function(e){e.module("angular-vissense.services").factory("VisSense",["$window",function(e){return e.VisSense}]).factory("VisUtils",["VisSense",function(e){return e.Utils}]).factory("VisSenseService",["VisSense",function(i){var t=function(t,n){var s=e.element("#"+t);return s.length<1||!s[0]?null:new i(s[0],n)};return{fromId:t}}])}(angular);